<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{backoffice/layout :: layout (~{::title}, ~{::content})}">
<head>
    <title>Diffusion Publicitaire - Formulaire</title>
</head>
<body>
    <th:block th:fragment="content">
        <div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1>
                    <i class="bi bi-broadcast"></i>
                    <span th:if="${diffusion.idDiffusionPubDetails == null}">Nouvelle Diffusion Publicitaire</span>
                    <span th:if="${diffusion.idDiffusionPubDetails != null}">Modifier Diffusion Publicitaire</span>
                </h1>
                <a href="/admin/diffusions-publicitaires" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Retour √† la liste
                </a>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-form"></i> Informations de la Diffusion</h5>
                </div>
                <div class="card-body">
                      <form th:action="${diffusion.idDiffusionPubDetails == null} ? '/admin/diffusions-publicitaires/save' : '/admin/diffusions-publicitaires/' + diffusion.idDiffusionPubDetails + '/edit'" 
                          th:object="${diffusion}" method="post">
                        
                        <!-- Champ cach√© pour l'ID en mode √©dition -->
                        <input type="hidden" th:field="*{idDiffusionPubDetails}" th:if="${diffusion.idDiffusionPubDetails != null}">
                        
                        <!-- Vid√©o Publicitaire (obligatoire) -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="videoPublicitaire" class="form-label">
                                    <i class="bi bi-camera-video"></i> Vid√©o Publicitaire *
                                </label>
                                <select class="form-select" id="videoPublicitaire" th:field="*{videoPublicitaire.idVideoPublicitaire}" required>
                                    <option value="">-- S√©lectionner une vid√©o publicitaire --</option>
                                    <option th:each="video : ${videos}" 
                                            th:value="${video.idVideoPublicitaire}"
                                            th:text="${video.titre + ' - ' + video.societe.nom}">
                                    </option>
                                </select>
                                <div class="form-text">Choisissez la vid√©o √† diffuser</div>
                            </div>
                            
                            <!-- Voyage-V√©hicule (obligatoire) -->
                            <div class="col-md-6">
                                <label for="voyageVehicule" class="form-label">
                                    <i class="bi bi-truck"></i> Voyage-V√©hicule *
                                </label>
                                <select class="form-select" id="voyageVehicule" th:field="*{voyageVehicule.idVoyageVehicule}" required>
                                    <option value="">-- S√©lectionner un voyage-v√©hicule --</option>
                                    <option th:each="vv : ${voyageVehicules}" 
                                          th:value="${vv.idVoyageVehicule}"
                                          th:text="${(vv.vehicule != null ? vv.vehicule.immatriculation : 'V√©hicule #' + vv.idVoyageVehicule) +
                                                (vv.voyage != null and vv.voyage.trajet != null and vv.voyage.trajet.gareRoutiereDepart != null and vv.voyage.trajet.gareRoutiereArrivee != null ? ' - ' + vv.voyage.trajet.gareRoutiereDepart.nom + ' ‚Üí ' + vv.voyage.trajet.gareRoutiereArrivee.nom : '') +
                                                (vv.voyage != null and vv.voyage.dateDepart != null ? ' (' + #temporals.format(vv.voyage.dateDepart, 'dd/MM/yyyy') + ')' : '')}">
                                    </option>
                                </select>
                                <div class="form-text">V√©hicule qui diffusera la publicit√©</div>
                            </div>
                        </div>
                        
                        <!-- Date de Diffusion et Nombre de Diffusions -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="dateDiffusionStr" class="form-label">
                                    <i class="bi bi-calendar-event"></i> Date et Heure de Diffusion
                                </label>
                                    <input type="datetime-local" class="form-control" id="dateDiffusionStr" name="dateDiffusionStr" 
                                        th:value="${diffusion.dateDiffusion != null ? (#temporals.format(diffusion.dateDiffusion, 'yyyy-MM-dd') + 'T' + #temporals.format(diffusion.dateDiffusion, 'HH:mm')) : ''}">
                                <div class="form-text">Laissez vide pour utiliser la date/heure actuelle</div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="nbDiffusion" class="form-label">
                                    <i class="bi bi-arrow-repeat"></i> Nombre de Diffusions *
                                </label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="nbDiffusion" th:field="*{nbDiffusion}" 
                                           required min="1" max="100" 
                                           th:value="${diffusion.nbDiffusion != null ? diffusion.nbDiffusion : 1}">
                                    <span class="input-group-text">fois</span>
                                </div>
                                <div class="form-text">Nombre de fois que la vid√©o sera diffus√©e (1-100)</div>
                            </div>
                        </div>
                        
                        <!-- Zone d'information du co√ªt estim√© -->
                        <div class="alert alert-info mb-4">
                            <h6 class="mb-2">
                                <i class="bi bi-info-circle"></i> Estimation du Co√ªt
                            </h6>
                            <p class="mb-0">
                                <strong>Calcul :</strong> Nombre de diffusions √ó Tarif par diffusion de la soci√©t√©
                            </p>
                            <p class="mb-0 text-muted">
                                Le co√ªt total sera calcul√© automatiquement en fonction de la soci√©t√© s√©lectionn√©e et du nombre de diffusions.
                            </p>
                        </div>
                        
                        <!-- Boutons d'action -->
                        <div class="d-flex justify-content-between">
                            <div>
                                <a href="/admin/diffusions-publicitaires" class="btn btn-secondary">
                                    <i class="bi bi-x-circle"></i> Annuler
                                </a>
                            </div>
                            <div>
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-check-circle"></i>
                                    <span th:if="${diffusion.idDiffusionPubDetails == null}">Cr√©er la Diffusion</span>
                                    <span th:if="${diffusion.idDiffusionPubDetails != null}">Mettre √† Jour</span>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Informations compl√©mentaires -->
            <div class="card mt-4">
                <div class="card-header">
                    <h6><i class="bi bi-lightbulb"></i> Aide</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h6>üìπ Vid√©o Publicitaire</h6>
                            <p class="text-muted small">
                                S√©lectionnez la vid√©o publicitaire qui sera diffus√©e dans le v√©hicule.
                            </p>
                        </div>
                        <div class="col-md-4">
                            <h6>üöê Voyage-V√©hicule</h6>
                            <p class="text-muted small">
                                Choisissez le v√©hicule et le voyage pendant lequel la publicit√© sera diffus√©e.
                            </p>
                        </div>
                        <div class="col-md-4">
                            <h6>üî¢ Nombre de Diffusions</h6>
                            <p class="text-muted small">
                                Indiquez combien de fois la vid√©o sera diffus√©e pendant le voyage.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Script pour am√©liorer l'exp√©rience utilisateur -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            const videoSelect = document.getElementById('videoPublicitaire');
            const voyageVehiculeSelect = document.getElementById('voyageVehicule');
            const nbDiffusionInput = document.getElementById('nbDiffusion');
            
            // Validation en temps r√©el
            function validateForm() {
                const isValid = videoSelect.value && voyageVehiculeSelect.value && nbDiffusionInput.value;
                const submitBtn = document.querySelector('button[type="submit"]');
                
                if (isValid) {
                    submitBtn.classList.remove('disabled');
                } else {
                    submitBtn.classList.add('disabled');
                }
            }
            
            videoSelect.addEventListener('change', validateForm);
            voyageVehiculeSelect.addEventListener('change', validateForm);
            nbDiffusionInput.addEventListener('input', validateForm);
            
            // Validation initiale
            validateForm();
        });
        </script>
    </th:block>
</body>
</html>